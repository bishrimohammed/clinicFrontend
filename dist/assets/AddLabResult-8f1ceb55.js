import{l as w,Q as I,j as e,u as F,r as T,f as B,m as M}from"./index-adc5c439.js";import{u as H}from"./index.esm-28bdf91a.js";import{u as _}from"./useMutation-46d3959e.js";import{A as k}from"./useAxiosHeaders-0302b736.js";import{A as E}from"./axiosInstance-8e812653.js";import{c as q,h as Q,f as D,a as S,o as G}from"./yup-e734d6e3.js";import{M as n}from"./Modal-07b4d2ea.js";import{C as P,b as $}from"./InputGroupContext-86e132d6.js";import{F as c}from"./Form-fd32e757.js";import{T as L}from"./Table-892073ec.js";import{f as V,a as z}from"./formatDate-f5528b17.js";import"./DefaultLayout-65fbaa93.js";import"./index.esm-650f3687.js";import"./index.es-ffb0b0ea.js";import"./NoopTransition-52f737ac.js";import"./divWithClassName-747f8fd3.js";import"./ElementChildren-abb33785.js";import"./Col-cdbc53ce.js";import"./moment-fbc5633a.js";const K=()=>{const l=w(),o=k();return _({mutationFn:async({data:t,labId:d})=>E.post(`medicalrecords/${d}/addInvestigationResult`,t,{...o}),onSuccess:async t=>{const{data:d}=t;l.invalidateQueries({queryKey:["MedicalHistory",d.medicalId,"Ordered Lab Investigations"],exact:!0}),I.success("investigations successfully submited")},onError:t=>{I.error(t.response.data.message)}})},O=q().shape({labresults:Q().of(q().shape({orderId:D(),result:S().required("Result is required"),comment:S()})).required("Lab is required")}),J=({handleClose:l,lab:o,labId:t})=>{const{register:d,handleSubmit:i,formState:{errors:s}}=H({resolver:G(O)});F(a=>a.auth.user);const{mutateAsync:m,isPending:h}=K();console.log(o);const u=a=>{console.log(a),m({data:a,labId:t}).then(r=>{if(console.log(r),r.status===201)return l()})};return e.jsx(P,{children:e.jsxs(c,{className:"d-flex flex-column",onSubmit:i(u),children:[e.jsxs(L,{responsive:!0,bordered:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"id"}),e.jsx("th",{children:"Test Name"}),e.jsx("th",{children:"Result Value"}),e.jsx("th",{children:"Comment"})]})}),e.jsx("tbody",{children:o.map((a,r)=>{var x,j,b,f,p,y,C,g,N,R,A;return e.jsxs("tr",{children:[e.jsx("td",{children:a.id}),e.jsxs("td",{children:[e.jsx(c.Control,{className:"mb-1",type:"number",name:`labresults[${r}].orderId`,value:a.id,...d(`labresults[${r}].orderId`),hidden:!0}),a.test.service_name]}),e.jsx("td",{children:e.jsxs(c.Group,{className:"my-0",children:[e.jsx(c.Control,{type:"text",placeholder:"result",...d(`labresults[${r}].result`),className:"my-0",defaultValue:a.result&&a.result,isInvalid:(j=(x=s==null?void 0:s.labresults)==null?void 0:x[r])==null?void 0:j.result}),e.jsx(c.Control.Feedback,{type:"invalid",children:(p=(f=(b=s==null?void 0:s.labresults)==null?void 0:b[r])==null?void 0:f.result)==null?void 0:p.message})]})}),e.jsx("td",{children:e.jsxs(c.Group,{className:"my-0",controlId:"formControlsTextarea",children:[e.jsx(c.Control,{name:`labresults[${r}].comment`,...d(`labresults[${r}].comment`),type:"text",placeholder:"comment",className:"my-0",isInvalid:(C=(y=s==null?void 0:s.labresults)==null?void 0:y[r])==null?void 0:C.comment}),e.jsx(c.Control.Feedback,{type:"invalid",children:(A=(R=(N=(g=s.errors)==null?void 0:g.labresults)==null?void 0:N[r])==null?void 0:R.comment)==null?void 0:A.message})]})})]},r)})})]}),e.jsx(n.Footer,{style:{justifyContent:"initial"},children:e.jsx("div",{className:"d-flex w-100  justify-content-end",children:e.jsx($,{variant:"primary",className:"w-100",type:"submit",children:"Submit Result"})})})]})})},U=l=>{console.log(l);const o=()=>{l.handleClose()};return e.jsxs(n,{size:"xl",show:l.show,onHide:l.handleClose,children:[e.jsx(n.Header,{closeButton:!0,children:e.jsx(n.Title,{children:"Add Laboratory Result"})}),e.jsx(n.Body,{children:e.jsx(J,{labId:l.labId,lab:l.lab,handleClose:o})})]})},xe=()=>{const[l,o]=T.useState(!1),{state:t}=B();M();const d=()=>o(!1),i=()=>{o(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(U,{show:l,handleClose:d,handleShow:i,lab:t.orderedTests,labId:t==null?void 0:t.id}),e.jsx("h3",{children:"Add Lab Results"}),e.jsx("h6",{children:"clinical finding"}),e.jsx("p",{children:t==null?void 0:t.clinical_finding}),e.jsxs(L,{striped:!0,bordered:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date Requested"}),e.jsx("th",{children:"Test Name"}),e.jsx("th",{children:"Requested By"}),e.jsx("th",{children:"status"})]})}),e.jsxs("tbody",{children:[t==null?void 0:t.orderedTests.map((s,m)=>{var h,u;return e.jsxs("tr",{children:[e.jsxs("td",{children:[V(s==null?void 0:s.order_time)," ",z(s==null?void 0:s.order_time)]}),e.jsx("td",{children:s==null?void 0:s.test.service_name}),e.jsxs("td",{children:[(h=s==null?void 0:s.requestedBy)==null?void 0:h.firstName," ",(u=s==null?void 0:s.requestedBy)==null?void 0:u.lastName]}),e.jsx("td",{children:s==null?void 0:s.status})]},m)}),e.jsx("tr",{})]})]}),e.jsx("div",{className:"d-flex w-100  justify-content-end",children:e.jsx("div",{children:e.jsx($,{onClick:i,className:"ms-3",variant:"success",type:"button",children:"+ Add Lab Result"})})})]})};export{xe as default};
