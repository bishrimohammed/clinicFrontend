import{d as M,Q as A,r as W,j as e}from"./index-adc5c439.js";import{C as z,b as Q}from"./InputGroupContext-86e132d6.js";import{u as Y}from"./index.esm-28bdf91a.js";import{c as D,a as d,f as K,g as b,b as J,o as U}from"./yup-e734d6e3.js";import{T as j}from"./TextInput-568ed4bc.js";import{u as X}from"./useMutation-46d3959e.js";import{A as E}from"./axiosInstance-8e812653.js";import{A as Z}from"./useAxiosHeaders-0302b736.js";import{u as ee}from"./useQuery-0c7d53ac.js";import{F as s}from"./Form-fd32e757.js";import{R as c}from"./Row-191556ab.js";import{C as n}from"./Col-cdbc53ce.js";import{S as se}from"./index.esm-650f3687.js";import"./ElementChildren-abb33785.js";const ae=()=>{const{headers:i}=Z();return M(),X({mutationFn:async r=>E.post("/patient",r,{headers:i}),onSuccess:async r=>{A.success("Registered succeessfully")},onError:async r=>{A.error(r.response.data.message)}})},re=D().shape({firstName:d().required("first Name is required"),middleName:d().required("middle Name is required"),lastName:d(),gender:d().required("gender is required"),age:K().transform(i=>isNaN(i)?void 0:i).positive().integer().min(0).max(100),is_dependent:b().required("is_dependent"),woreda:d(),kebele:d(),address:D().shape({street:d().required("street is required"),woreda_id:d().required("woreda is required"),house_number:d(),email:d().email("Invalid email"),phone_1:d().matches(/^(09|07)\d{8}$/,"Phone number is invalid").required("Phone number is required"),phone_2:d().nullable()}),birth_date:J().transform((i,r)=>{if(r&&typeof r=="string"){const m=new Date(r);return isNaN(m)?r:m}return i}).max(new Date(Date.now()),"date must be less than or equal to today").typeError("Type an end date"),is_new:b().required("patient type is required"),manual_card_id:d().when("is_new",([i],r)=>i?r.nullable():r.required("manual_card_id is required when patient is not new")),is_credit:b().transform((i,r)=>r==="true"?!0:r==="false"?!1:i).required("payment way is required"),credit_company_id:d().when("is_credit",([i],r)=>i?r.required("company must be provided when payment way is credit"):r.nullable())}),Ne=()=>{var y,f,g,_,w,v,C,S,q,k,I,F,G,L,P;const{mutateAsync:i,isPending:r}=ae(),[m,$]=W.useState(!0),u=ee({queryKey:["woredas"],queryFn:async()=>E.get("/woreda").then(l=>l.data),staleTime:5*1e3*1e3}),{register:t,formState:{errors:a},handleSubmit:T,watch:x,setValue:R}=Y({defaultValues:{firstName:"",middleName:"",lastName:"",age:"",gender:"",address:{street:"",woreda_id:"",house_number:"",email:"",phone_1:"",phone_2:null},birth_date:new Date().toISOString().substring(0,10),is_dependent:!1,is_new:!0,manual_card_id:null,is_credit:!1,credit_company_id:null},resolver:U(re)});console.log(a);const V=x("age"),N=x("is_credit"),p=x("is_new");if(console.log(typeof p),console.log(a),new Date().toISOString().substring(0,10),!m){const l=new Date().toISOString().substring(0,10),o=new Date(l);o.setFullYear(o.getFullYear()-V),R("birth_date",o.toISOString().substring(0,10))}const O=async l=>{console.log(l);const{age:o,...h}=l;i(h).then(H=>{console.log(H)})},B=N?e.jsxs(s.Group,{className:"",children:[e.jsx(s.Label,{className:"text-nowrap",children:"company agreement"}),e.jsxs(s.Select,{...t("credit_company_id"),isInvalid:a.credit_company_id,children:[e.jsx("option",{value:"",children:"Select company"}),e.jsx("option",{value:"1",children:"softnet solution"}),e.jsx("option",{value:"2",children:"addis sw"})]}),e.jsx(s.Control.Feedback,{type:"invalid",className:"small text-danger",children:(y=a.credit_company_id)==null?void 0:y.message})]}):null;return e.jsx(z,{className:"p-3 mb-4",children:e.jsxs("div",{className:"p-3 bg-hrun-box hrunboxshadow",children:[e.jsx("div",{className:"mb-2",children:e.jsx("h4",{children:" Patient Information"})}),e.jsx("hr",{className:"mt-1"}),e.jsxs(s,{onSubmit:T(O),children:[e.jsx("h6",{className:"border-bottom border-1 p-1 mb-3 fw-bold",children:"Basic Information"}),e.jsxs(c,{children:[e.jsx(n,{md:4,sm:12,className:"mb-2",children:e.jsx(j,{label:"First Name",register:t,name:"firstName",errors:a.firstName})}),e.jsx(n,{md:4,sm:12,className:"mb-2",children:e.jsx(j,{label:"Middle Name",register:t,name:"middleName",errors:a.middleName})}),e.jsx(n,{md:4,sm:12,className:"mb-2",children:e.jsx(j,{label:"Last Name",register:t,name:"lastName",errors:a.lastName})})]}),e.jsxs(c,{children:[e.jsx(n,{md:4,sm:12,className:"mb-2",children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Gender"}),e.jsxs(s.Select,{...t("gender"),isInvalid:a.gender,"aria-label":"Default select example",children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"male"}),e.jsx("option",{value:"female",children:"female"})]}),e.jsx(s.Control.Feedback,{type:"inValid",className:"small text-danger",children:(f=a.gender)==null?void 0:f.message})]})}),e.jsx(n,{md:4,sm:12,className:"mb-2",children:e.jsxs(s.Group,{children:[e.jsxs("div",{className:"d-flex gap-3",children:[e.jsx(s.Label,{children:"Date of Birth"}),e.jsx(s.Check,{type:"switch",size:"sm",checked:m,label:"is known",onChange:l=>{$(l.target.checked)}})]}),e.jsx(s.Control,{type:"date",name:"birth_date",...t("birth_date"),disabled:!m,isInvalid:a.birth_date}),e.jsx(s.Control.Feedback,{type:"inValid",className:"small text-danger",children:(g=a.birth_date)==null?void 0:g.message})]})}),e.jsx(n,{md:4,sm:12,className:"mb-2",children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx("div",{className:"d-flex gap-3",children:e.jsx(s.Label,{children:"Age"})}),e.jsx(s.Control,{type:"number",required:!m,disabled:m,...t("age",{required:[m==="true"],min:18,max:100}),isInvalid:a.age,placeholder:"Enter age"}),e.jsx(s.Control.Feedback,{type:"inValid",className:"small text-danger",children:(_=a==null?void 0:a.age)==null?void 0:_.message})]})})]}),e.jsx("h6",{className:"border-bottom border-1 border-black py-2 mb-3 fw-bold",children:"Address Information"}),e.jsxs(c,{children:[e.jsx(n,{md:4,sm:12,className:"mb-2",children:e.jsx(s.Check,{type:"checkbox",label:"Is Dependent",...t("is_dependent")})}),e.jsxs(n,{md:4,sm:12,className:"mb-2",children:[e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Phone"}),e.jsx(s.Control,{type:"number",placeholder:"09/07********",...t("address.phone_1"),isInvalid:(w=a.address)==null?void 0:w.phone_1})]}),e.jsx(s.Control.Feedback,{type:"inValid",className:"small text-danger",children:(C=(v=a==null?void 0:a.address)==null?void 0:v.phone_1)==null?void 0:C.message})]}),e.jsx(n,{md:4,sm:12,className:"mb-2",children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Email"}),e.jsx(s.Control,{type:"email",...t("address.email",{}),placeholder:"example@example.com",isInvalid:(S=a.address)==null?void 0:S.email}),e.jsx(s.Control.Feedback,{type:"inValid",className:"small text-danger",children:(k=(q=a==null?void 0:a.address)==null?void 0:q.email)==null?void 0:k.message})]})}),e.jsx(n,{md:4,sm:12,className:"mb-2",children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Woreda"}),e.jsxs(s.Select,{...t("address.woreda_id"),children:[e.jsx("option",{value:"",children:"Select Woreda"}),(I=u==null?void 0:u.data)==null?void 0:I.map((l,o)=>{var h;return e.jsxs("option",{value:l.id,children:[l.name," ",(h=l.SubCity)==null?void 0:h.Subcity_name]},o)})]})]})}),e.jsx(n,{md:4,sm:12,className:"mb-2",children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Street Address"}),e.jsx(s.Control,{type:"text",...t("address.street")})]})}),e.jsx(n,{md:4,sm:12,className:"mb-2",children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"House Number"}),e.jsx(s.Control,{type:"number",...t("address.house_number")})]})}),e.jsx(n,{md:4,sm:12,className:"mb-2",children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Alternative Phone"}),e.jsx(s.Control,{type:"number",...t("address.phone_2",{pattern:{value:/^(09|07)?\d{8}$/,message:"phone number is invalid"}}),placeholder:"09/07********",isInvalid:(F=a.address)==null?void 0:F.phone_2}),e.jsx(s.Control.Feedback,{type:"inValid",className:"small tetx-danger",children:(L=(G=a==null?void 0:a.address)==null?void 0:G.phone_2)==null?void 0:L.message})]})})]}),e.jsx("h6",{className:"border-bottom border-1 border-black py-2 mb-3 fw-bold",children:"Patient Type"}),e.jsxs(c,{children:[e.jsx(n,{md:4,sm:12,children:e.jsxs(s.Group,{className:"",children:[e.jsx(s.Label,{className:"text-nowrap",children:"Patient Type"}),e.jsxs(s.Select,{...t("is_new"),isInvalid:a.is_new,children:[e.jsx("option",{value:"true",children:"New"}),e.jsx("option",{value:"false",children:"Existing"})]})]})}),e.jsx(n,{md:4,sm:12,className:"mb-2",children:p==="false"?e.jsxs(s.Group,{className:"",children:[e.jsx(s.Label,{className:"text-nowrap",children:"Manual Card Number"}),e.jsx(s.Control,{type:"text",...t("manual_card_id",{required:[p==="true"]}),isInvalid:a.manual_card_id}),e.jsx(s.Control.Feedback,{type:"inValid",className:"small text-danger",children:(P=a==null?void 0:a.manual_card_id)==null?void 0:P.message})]}):null})]}),e.jsx("h6",{className:"border-bottom border-1 border-black py-2 my-3 fw-bold",children:"Patient payment way"}),e.jsxs(c,{children:[e.jsx(n,{md:4,sm:12,children:e.jsxs(s.Group,{className:"",children:[e.jsx(s.Label,{className:"text-nowrap",children:"Payment way"}),e.jsxs(s.Select,{...t("is_credit"),children:[e.jsx("option",{value:"false",children:"self payer"}),e.jsx("option",{value:"true",children:"credit"})]})]})}),e.jsx(n,{md:4,sm:12,children:N==="true"&&B}),e.jsx(n,{})]}),e.jsx("hr",{}),e.jsx("div",{className:"d-flex justifyContentEnd",children:e.jsx(n,{children:e.jsxs(Q,{variant:"primary",disabled:r,className:"w-100",type:"submit",children:[r&&e.jsx(se,{animation:"border",size:"sm"}),"Register Patient"]})})})]})]})})};export{Ne as default};
