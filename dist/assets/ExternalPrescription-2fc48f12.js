import{l as F,Q as h,r as o,m as H,j as e}from"./index-adc5c439.js";import{M as Q}from"./DefaultLayout-65fbaa93.js";import{f as z}from"./formatDate-f5528b17.js";import{C as x,E as I,f as O,R as T}from"./SelectedOptions-cf20983c.js";import{A as B}from"./useAxiosHeaders-0302b736.js";import{u as K}from"./useMutation-46d3959e.js";import{A as L}from"./axiosInstance-8e812653.js";import{C as $,b as S}from"./InputGroupContext-86e132d6.js";import{F as t}from"./Form-fd32e757.js";import{R as q}from"./Row-191556ab.js";import{C as s}from"./Col-cdbc53ce.js";import{T as J}from"./Table-892073ec.js";import{M as U}from"./Modal-07b4d2ea.js";import{S as V}from"./index.esm-650f3687.js";import"./index.es-ffb0b0ea.js";import"./moment-fbc5633a.js";import"./ElementChildren-abb33785.js";import"./NoopTransition-52f737ac.js";import"./divWithClassName-747f8fd3.js";const W=()=>{const m=B(),a=F();return K({mutationFn:async l=>L.post("/patienthistory/external_prescription",l,m).then(n=>n.data),onSuccess:async(l,n)=>{h.success("successfully prescribed"),a.invalidateQueries({queryKey:["MedicalHistory",n.historyId,"ExternalPrescription"],exact:!0})},onError:async l=>{var n;h.success((n=l==null?void 0:l.response)==null?void 0:n.data.message)}})},pe=({history:m})=>{const[a,l]=o.useState([]),[n,j]=o.useState(null),[i,p]=o.useState(null),[d,f]=o.useState(null),{mutateAsync:R,isPending:y}=W(),b=o.useRef(),g=o.useRef(),N=o.useRef(),C=o.useRef(),{historyId:w}=H(),E=async()=>{if(a.length!==0){let r={medication:a,historyId:w};console.log(r),R(r).then(c=>{c.status&&l([])})}},M=r=>{r.preventDefault();const c=b.current.value,u=g.current.value,_=d==null?void 0:d.value,k=i==null?void 0:i.value,D=C.current.value,G=N.current.value;if(!n||!c||!u){alert("add all field");return}const v=a.some(P=>Object.values(P).includes(n.drugname));if(console.log(v),v){h.error("you selected already");return}const A={drugname:n.drugname,dosage:c,frequency:_,route:k,number_of_days:D,qty:u,remark:G,form:""};l([...a,A]),j(null),f(null),p(null)};return e.jsxs($,{className:"minHeight100  py-2 px-0",children:[e.jsxs(t,{className:"d-flex flex-column ",onSubmit:M,children:[e.jsx("div",{className:"bluewhite-bg py-1",children:e.jsxs(q,{className:"  w-100",children:[e.jsx(s,{sm:3,className:"ps-3",children:"medicine"}),e.jsx(s,{children:"dose"}),e.jsx(s,{children:"frequency"}),e.jsx(s,{sm:2,children:"route"}),e.jsx(s,{children:"StartDate"}),e.jsx(s,{children:"Qty"}),e.jsx(s,{children:e.jsx("span",{className:"text-nowrap",children:"No of days"})}),e.jsx(s,{children:"Remark"})]})}),e.jsxs("div",{className:"d-flex flex-column gap-2 w-100 ",children:[e.jsxs(q,{className:"border border-1 py-3 ",children:[e.jsx(s,{sm:3,className:"ps-3",children:e.jsx(t.Group,{children:e.jsx(x,{onChange:j,value:n,options:I,isClearable:!0})})}),e.jsx(s,{className:"ps-0",children:e.jsx(t.Group,{children:e.jsx(t.Control,{ref:b,type:"text",placeholder:"Enter..."})})}),e.jsx(s,{className:"px-0",children:e.jsx(t.Group,{className:"d-flex gap-2 align-items-center",children:e.jsx(x,{className:"w-100",isClearable:!0,options:O,onChange:f,placeholder:"",value:d})})}),e.jsx(s,{sm:2,className:"pe-0",children:e.jsx(t.Group,{className:"d-flex gap-2 align-items-center",children:e.jsx(x,{className:"w-100",isClearable:!0,options:T,onChange:p,value:i})})}),e.jsx(s,{children:e.jsx(t.Group,{children:e.jsx("div",{className:"px-3 py-2",style:{backgroundColor:"rgb(233, 236, 239)"},disabled:!0,children:z(Date.now())})})}),e.jsx(s,{sm:1,className:"",children:e.jsx(t.Group,{children:e.jsx(t.Control,{ref:g,type:"number"})})}),e.jsx(s,{children:e.jsx(t.Group,{children:e.jsx(t.Control,{ref:C,type:"number"})})}),e.jsx(s,{className:"ps-0 pe-2",children:e.jsx(t.Group,{children:e.jsx(t.Control,{ref:N,type:"text",placeholder:"Enter..."})})})]}),e.jsx("div",{className:"d-flex ms-2",children:e.jsx(S,{disabled:!m.status,variant:"success",className:"px-4",type:"submit",children:"+ Add"})})]})]}),e.jsx("hr",{}),e.jsxs(J,{striped:!0,bordered:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Drug name"}),e.jsx("th",{children:"Dosage"}),e.jsx("th",{children:"frequency"}),e.jsx("th",{children:"route"}),e.jsx("th",{children:"No of Days"}),e.jsx("th",{children:"quantity"}),e.jsx("th",{children:"remark"}),e.jsx("th",{children:"remove"})]})}),e.jsx("tbody",{children:a.length!==0&&a.map((r,c)=>e.jsxs("tr",{children:[e.jsx("td",{children:c+1}),e.jsx("td",{children:r.drugname}),e.jsx("td",{children:r.dosage}),e.jsx("td",{children:r.frequency}),e.jsx("td",{children:r.route}),e.jsx("td",{children:r.number_of_days}),e.jsx("td",{children:r.qty}),e.jsx("td",{children:r.remark}),e.jsx("td",{children:e.jsx(Q,{color:"red",onClick:()=>{l(a.filter(u=>u.drugname!==r.drugname))},size:20,cursor:"pointer"})})]},c))})]}),e.jsx(U.Footer,{style:{justifyContent:"initial"},children:e.jsx("div",{className:"d-flex w-100  justify-content-end",children:e.jsxs(S,{variant:"primary",disabled:a.length===0||y,className:"w-100",onClick:E,type:"button",children:[y&&e.jsx(V,{animation:"border",size:"sm"}),"Prescribe"]})})})]})};export{pe as default};
