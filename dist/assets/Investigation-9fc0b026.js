import{r as x,R as v,j as e,m as B,u as k,d as S}from"./index-adc5c439.js";import{f as j,a as u}from"./formatDate-f5528b17.js";import{u as q}from"./useMedicalhistory-d492c1f3.js";import{u as D}from"./useQuery-0c7d53ac.js";import{A as P}from"./axiosInstance-8e812653.js";import{A as L}from"./useAxiosHeaders-0302b736.js";import{l as y,P as T,a as w}from"./PatientInfornPrint-13730abd.js";import{S as C}from"./index.esm-650f3687.js";import{T as F,a as g}from"./Tabs-162d704d.js";import{T as I}from"./Table-892073ec.js";import{b as N}from"./InputGroupContext-86e132d6.js";import"./moment-fbc5633a.js";import"./useGetClinicInformation-c3f94354.js";import"./DefaultLayout-65fbaa93.js";import"./index.es-ffb0b0ea.js";import"./Nav-d46f6c14.js";import"./NoopTransition-52f737ac.js";import"./CardHeaderContext-3f12a520.js";import"./ElementChildren-abb33785.js";function H(s){const a=L();return D({queryKey:["MedicalHistory",s,"Ordered Lab Investigations"],queryFn:async()=>P.get(`medicalrecords/${s}/investigation`,{headers:a}).then(r=>(console.log("useOrdered_Lab_Investigations feat"),console.log(r.data),r.data)),staleTime:5*60*1e3})}const O=x.memo(x.forwardRef((s,a)=>{var c,i,l,d,m,t,h,b,R,f;const r=x.useRef(),n=y.useReactToPrint({content:()=>r.current,documentTitle:"hello"});return v.useImperativeHandle(a,()=>({printData:n})),e.jsx("div",{ref:r,children:e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"p-2",children:[e.jsx(T,{}),e.jsx("hr",{className:"opacity-100 border-2 mt-4 border-dark"}),e.jsxs("div",{className:"report-info d-flex px-2 justify-content-between",children:[e.jsxs("div",{children:[e.jsx("h6",{children:"Demography Information"}),e.jsx(w,{})]}),e.jsxs("div",{children:[e.jsx("h6",{children:"Routing Information"}),e.jsxs("div",{className:"ps-2 mb-1",children:[e.jsx("span",{className:"fw-bold me-1",children:"Order Time:"})," ",j((c=s==null?void 0:s.labResult)==null?void 0:c.orderTime),u((i=s==null?void 0:s.labResult)==null?void 0:i.orderTime)]}),e.jsxs("div",{className:"ps-2 mb-1",children:[e.jsx("span",{className:"fw-bold me-1",children:"Report Time:"})," ",j((l=s==null?void 0:s.labResult)==null?void 0:l.reportTime)," ",u((d=s==null?void 0:s.labResult)==null?void 0:d.reportTime)]}),e.jsxs("div",{className:"ps-2 mb-1",children:[e.jsx("span",{className:"fw-bold me-1",children:"Request By: "}),(t=(m=s==null?void 0:s.labResult)==null?void 0:m.requestBy)==null?void 0:t.username]}),e.jsxs("div",{className:"ps-2 mb-1",children:[e.jsx("span",{className:"fw-bold me-1",children:"Reported By:"})," ",(b=(h=s==null?void 0:s.labResult)==null?void 0:h.reportedBy)==null?void 0:b.username]})]})]}),e.jsx("div",{className:"test-results mt-4",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Test Name"}),e.jsx("th",{children:"Result value & unit"}),e.jsx("th",{children:"Ref Renge"}),e.jsx("th",{children:"Done By"}),e.jsx("th",{children:"Done Time"}),e.jsx("th",{children:"Report Time"})]})}),e.jsx("tbody",{children:(f=(R=s==null?void 0:s.labResult)==null?void 0:R.testResult)==null?void 0:f.map((o,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:o.testId.test_name}),e.jsxs("td",{children:[o.resultValue," ",o.unit]}),e.jsx("td",{children:o.referenceRange}),e.jsx("td",{children:s==null?void 0:s.labResult.reportedBy.username}),e.jsx("td",{children:u(s==null?void 0:s.labResult.orderTime)})]},_))})]})})]})})})})),A=x.memo(x.forwardRef((s,a)=>{var c,i,l,d,m,t,h,b,R;const r=x.useRef(),n=y.useReactToPrint({content:()=>r.current,documentTitle:"hello"});return v.useImperativeHandle(a,()=>({printData:n})),e.jsx("div",{ref:r,children:e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"p-2",children:[e.jsx(T,{}),e.jsx("hr",{className:"opacity-100 border-2 mt-4 border-dark"}),e.jsxs("div",{className:"report-info d-flex px-2 justify-content-between",children:[e.jsxs("div",{children:[e.jsx("h6",{children:"Demography Information"}),e.jsx(w,{})]}),e.jsxs("div",{children:[e.jsx("h6",{children:"Routing Information"}),e.jsxs("div",{className:"ps-2 mb-1",children:[e.jsx("span",{className:"fw-bold me-1",children:"Order Time:"})," ",j((c=s==null?void 0:s.Result)==null?void 0:c.orderTime),"  ",u((i=s==null?void 0:s.Result)==null?void 0:i.orderTime)]}),e.jsxs("div",{className:"ps-2 mb-1",children:[e.jsx("span",{className:"fw-bold me-1",children:"Report Time:"}),"  ",j((l=s==null?void 0:s.Result)==null?void 0:l.reportTime)," ",u((d=s==null?void 0:s.Result)==null?void 0:d.reportTime)]}),e.jsxs("div",{className:"ps-2 mb-1",children:[e.jsx("span",{className:"fw-bold me-1",children:"Request By: "}),(t=(m=s==null?void 0:s.Result)==null?void 0:m.requestBy)==null?void 0:t.username]}),e.jsxs("div",{className:"ps-2 mb-1",children:[e.jsx("span",{className:"fw-bold me-1",children:"Reported By:"})," ",(b=(h=s==null?void 0:s.Result)==null?void 0:h.reportedBy)==null?void 0:b.username]})]})]}),e.jsx("hr",{className:"opacity-100 border-1 mt-4 border-dark"}),e.jsxs("div",{className:"test-results mt-4",children:[e.jsx("h6",{children:"Test Results"}),e.jsxs("div",{className:"p-2",children:[e.jsxs("span",{style:{fontWeight:500,fontSize:24},className:"fw-bold",children:["Tests :"," "]})," ",s.Result.investigations.map((f,o)=>e.jsxs("span",{children:[f.test_name,o!=s.Result.investigations.length&&","]},f._id))]}),e.jsxs("div",{className:"p-2",children:[e.jsx("h3",{children:"Report :"}),e.jsx("div",{style:{whiteSpace:"pre"},className:"px-3 ",children:(R=s.Result)==null?void 0:R.imageResult})]})]})]})})})})),le=()=>{const{historyId:s}=B(),{data:a,isPending:r}=q(s),{data:n,error:c}=H(s),i=k(t=>t.auth.user),[l,d]=x.useState("orders"),m=S();return r?e.jsx(C,{animation:"grow"}):c?"An error has occurred: "+c.message:e.jsx("div",{className:"mb-4",children:e.jsxs(F,{id:"controlled-tab-example",activeKey:l,onSelect:t=>d(t),className:"mb-3 border-bottom border-2",variant:"underline",fill:!0,children:[e.jsx(g,{eventKey:"orders",title:"Orders",children:l==="orders"&&e.jsxs(e.Fragment,{children:[e.jsx("h5",{className:"ps-2 bluewhite-bg py-1 ",children:"Investigation Order"}),e.jsxs(I,{striped:!0,bordered:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date Requested"}),e.jsx("th",{children:"Test Name"}),e.jsx("th",{children:"type"}),e.jsx("th",{children:"Requested By"}),e.jsx("th",{children:"status"})]})}),e.jsx("tbody",{children:n==null?void 0:n.orderedTest.map((t,h)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[j(t.orderTime)," ",u(t.orderTime)]}),e.jsx("td",{children:t.test.service_name}),e.jsx("td",{children:n.labcategoryIDS.includes(t.test.serviceCategory_id)?"lab":"imaging"}),e.jsxs("td",{children:[t.requestedBy.firstName," ",t.requestedBy.lastName]}),e.jsx("td",{children:t.status})]},h))})]}),(i.role.name==="doctor"||i.role.name==="laboratorian")&&e.jsx("div",{className:"d-flex w-100  justify-content-end",children:e.jsxs("div",{children:[i.role.name==="doctor"&&e.jsxs(e.Fragment,{children:[e.jsx(N,{onClick:()=>m("orderlab"),className:"ms-3",variant:"success",type:"button",disabled:!a.status,children:"+ New Lab"}),e.jsx(N,{onClick:()=>m("orderimage",{state:{patientId:1}}),className:"ms-3",variant:"success",type:"button",disabled:!a.status,children:"+ New Imaging"})]}),i.role.name==="laboratorian"&&e.jsx(N,{onClick:()=>m(`/patients/history/${a._id}/addlabresult`),className:"ms-3",variant:"success",type:"button",disabled:!a.status,children:"+ Add Result"})]})})]})}),e.jsx(g,{eventKey:"lab_result",title:"Laboratory Results",children:l==="lab_result"&&e.jsx(e.Fragment,{children:e.jsx(K,{labResult:n})})}),e.jsx(g,{eventKey:"image_result",title:"Imaging Results",children:l==="image_result"&&e.jsx(E,{data:imaging_investiagation})})]})})},K=s=>{var n,c,i,l;const a=x.useRef(null),r=()=>{a.current&&a.current.printData()};return e.jsx("div",{className:"p-1 boxshadow",children:((n=s.labResult)==null?void 0:n.testResult.length)!==0&&((c=s.labResult)!=null&&c.testResult)?e.jsxs(e.Fragment,{children:[e.jsxs(I,{striped:!0,bordered:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Test Name"}),e.jsx("th",{children:"Result"}),e.jsx("th",{children:"Ref Renge"}),e.jsx("th",{children:"unit"}),e.jsx("th",{children:"Order Time"}),e.jsx("th",{children:"Report Time"})]})}),e.jsx("tbody",{children:(l=(i=s==null?void 0:s.labResult)==null?void 0:i.testResult)==null?void 0:l.map((d,m)=>{var t,h;return e.jsxs("tr",{style:{fontSize:14},children:[e.jsx("td",{children:d.testId.test_name}),e.jsx("td",{children:d.resultValue}),e.jsx("td",{children:(t=d.testId)==null?void 0:t.referenceRange}),e.jsx("td",{children:(h=d.testId)==null?void 0:h.unit}),e.jsxs("td",{children:[j(s==null?void 0:s.labResult.orderTime)," ",u(s==null?void 0:s.labResult.orderTime)]}),e.jsxs("td",{children:[j(s==null?void 0:s.labResult.reportTime)," ",u(s==null?void 0:s.labResult.reportTime)]})]},m)})})]}),e.jsx("div",{className:"d-none",children:e.jsx(O,{labResult:s==null?void 0:s.labResult,ref:a})}),e.jsx("div",{className:"d-flex justify-content-end pe-5",children:e.jsx(N,{onClick:r,className:"px-4 ms-auto mb-3",children:e.jsx("span",{children:"print"})})})]}):e.jsx("div",{className:"p-2 text-center bg-success bg-opacity-25 text-dark",children:"There is no Lab Result for this history"})})},E=s=>{var n,c,i;const a=x.useRef(null),r=()=>{a.current&&a.current.printData()};return e.jsxs("div",{className:"p-2 boxshadow",children:[e.jsx("hr",{className:"mt-0 mb-1"}),(n=s.data)!=null&&n.imageResult?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-2",children:[e.jsx("span",{className:"me-2 fw-bold",children:"Tests : "}),e.jsx("span",{children:(c=s.data)==null?void 0:c.investigations.map((l,d)=>e.jsxs("span",{className:"me-2",children:[l.test_name," ",d!==s.data.investigations.length-1&&","]},d))})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"p-2",children:[e.jsx("h6",{className:"mb-3",children:"Report :"}),e.jsx("div",{style:{minHeight:300,width:800,whiteSpace:"pre"},className:"px-4 py-2 boxshadow",children:(i=s.data)==null?void 0:i.imageResult})]}),e.jsx("div",{className:"d-none",children:e.jsx(A,{Result:s==null?void 0:s.data,ref:a})}),e.jsx("div",{className:"d-flex justify-content-end pe-5",children:e.jsx(N,{onClick:r,className:"px-4 ms-auto mb-3",children:e.jsx("span",{children:"print"})})})]}):e.jsx("div",{className:"p-2 text-center bg-success bg-opacity-25 text-dark",children:"There is no Imaging Studyies Result for this history"})]})};export{le as default};
