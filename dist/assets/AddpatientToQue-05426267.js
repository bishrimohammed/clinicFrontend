import{j as e,l as B,r as o,Q as g,u as E,L as z}from"./index-adc5c439.js";import{u as G}from"./useQuery-0c7d53ac.js";import{A as F}from"./axiosInstance-8e812653.js";import{B as H}from"./index.esm-ed00e8fc.js";import{h as u}from"./moment-fbc5633a.js";import{u as Q}from"./useMutation-46d3959e.js";import{A as U}from"./useAxiosHeaders-0302b736.js";import{M as j}from"./Modal-07b4d2ea.js";import{C as w,b as C}from"./InputGroupContext-86e132d6.js";import{F as n}from"./Form-fd32e757.js";import{R}from"./Row-191556ab.js";import{C as i}from"./Col-cdbc53ce.js";import{S as L}from"./index.esm-650f3687.js";import{I as V}from"./InputGroup-96ea5c7a.js";import{T as _}from"./Table-892073ec.js";import"./DefaultLayout-65fbaa93.js";import"./index.es-ffb0b0ea.js";import"./NoopTransition-52f737ac.js";import"./divWithClassName-747f8fd3.js";import"./ElementChildren-abb33785.js";function I(){return G({queryKey:["patients"],queryFn:async()=>F.get("/patient").then(t=>t.data),staleTime:10*60*1e3})}const K=({patient:t,handleClose:l})=>{const{headers:x}=U(),p=B(),d=o.useRef(),c=o.useRef(),h=o.useRef(),m=u(new Date(t.lastVisit)||new Date).format("L"),f=u(new Date).format("L"),b=u(m),y=u(f).diff(b,"days");let s={isneeded:!1,reason:""};y>10?(s.isneeded=!0,s.reason="Patient has not been seen for more than 10 days."):t.patient_history.length===0?(s.isneeded=!0,s.reason="This is the first visit of this patient."):(s.isneeded=!1,s.reason="Patient has been seen within the last 10 days.");const a=Q({mutationKey:"admitPatient",mutationFn:async r=>F.post("/doctorque",r,{headers:x}),onSuccess:async r=>{g.success(`${r.data.patient.name}  admitted successfully`),l(),p.invalidateQueries({queryKey:["PatientWaitingList"],exact:!0})},onError:async r=>{console.log(r.response.data.message),g.error(r.response.data.message)}}),k=r=>{var v,P;r.preventDefault();const D=d.current.value,N=(v=c.current)==null?void 0:v.value,q=(P=h.current)==null?void 0:P.value,M=t.status?"followUp":"New",T=t._id;if(N&&N<=0){g.error("CopaymentFee must be greater than 0",{position:"top-right",autoClose:1e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"});return}const S={patientId:T,type:M,Assignnote:D,CopaymentFee:N,Copaymentnote:q};console.log(S),a.mutate(S)};return e.jsxs(w,{children:[e.jsxs("div",{className:"d-flex gap-4",children:[e.jsxs("span",{children:[e.jsx("span",{className:"fw-bold me-2",children:"Name:"}),t.name]}),e.jsxs("span",{children:[e.jsx("span",{className:"fw-bold me-2",children:"Sex:"}),t.gender]}),e.jsxs("span",{children:[e.jsx("span",{className:"fw-bold me-2",children:"MRN:"}),t.cardNumber]}),e.jsxs("span",{children:[e.jsx("span",{className:"fw-bold me-2",children:"Age:"}),t.age," years"]})]}),s.isneeded?e.jsxs("span",{style:{fontSize:10},className:"fw-bold text-danger",children:["he Need to Pay Registeration fee"," ",e.jsx("span",{className:"fw-bold me-1 ms-1 text-dark",children:"Reason:"}),e.jsx("span",{className:"text-dark",children:s.reason})]}):e.jsxs("span",{style:{fontSize:10},className:"fw-bold text-success",children:["He doesn't need to pay the registration fee",e.jsx("span",{className:"fw-bold me-1 ms-2 text-dark",children:"Reason:"}),e.jsx("span",{className:"text-dark",children:s.reason})]}),e.jsx("hr",{}),e.jsx("h6",{className:"mb-3 mt-3 fw-bold text-center",children:"Admission Details"}),e.jsxs(n,{onSubmit:k,children:[e.jsxs(R,{children:[e.jsx(i,{children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Assement Type"}),e.jsxs(n.Select,{disabled:!0,defaultValue:t.status?"followUp":"New",className:"border border-3","aria-label":"Default select example",children:[e.jsx("option",{value:"New",children:"New Visit"}),e.jsx("option",{value:"followUp",children:"followUp Visit"})]})]})}),e.jsx(i,{children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Assignment Note"}),e.jsx(n.Control,{className:"border border-3",ref:d,type:"text",placeholder:"Enter..."})]})})]}),s.isneeded&&e.jsxs(R,{children:[e.jsx("div",{className:"mb-2",style:{fontSize:"21px"},children:"Copayment Fee"}),e.jsx(i,{children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:" Fee Amount"}),e.jsx(n.Control,{className:"border border-3",ref:c,type:"number",required:!0,placeholder:"fee amount..."})]})}),e.jsx(i,{children:e.jsx(i,{children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:" Fee note"}),e.jsx(n.Control,{className:"border border-3",ref:h,type:"text",placeholder:"Enter..."})]})})})]}),e.jsx("hr",{}),e.jsx("div",{className:"d-flex justifyContentEnd",children:e.jsx(i,{children:e.jsxs(C,{variant:"primary",disabled:a.isPending,className:"w-100",type:"submit",children:[a.isPending&&e.jsx(L,{animation:"border",size:"sm"}),"Submit"]})})})]})]})},O=t=>{const l=()=>{t.handleClose()};return e.jsxs(j,{size:"lg",show:t.show,onHide:t.handleClose,children:[e.jsx(j.Header,{closeButton:!0,children:e.jsx(j.Title,{children:"Admit"})}),e.jsx(j.Body,{children:e.jsx(K,{patient:t.patient,handleClose:l})})]})},ue=()=>{const[t,l]=o.useState(""),{data:x,isPending:p,error:d}=I(),c=E(s=>s.auth.user),[h,m]=o.useState(!1),[f,b]=o.useState(null),A=()=>m(!1),y=()=>{m(!0)};return p?e.jsx(L,{animation:"grow"}):d?"An error has occurred: "+d.message:e.jsxs(e.Fragment,{children:[h&&e.jsx(O,{show:h,handleClose:A,handleShow:y,patient:f}),e.jsxs(w,{children:[e.jsxs("div",{className:" d-flex justify-content-between align-items-center w-100 mb-1",children:[e.jsx("h4",{className:"d-flex justify-content-center align-items-center mb-0",children:"Patients List"}),c.role==="cashier"&&e.jsx(z,{to:"/patient/newpatient",className:"btn btn-primary",children:"Add Patient"})]}),e.jsx("hr",{className:"bg-primary my-2"}),e.jsx(w,{children:e.jsx("div",{className:"search w-50",children:e.jsx(n,{children:e.jsxs(V,{className:"mb-3",children:[e.jsx(n.Control,{placeholder:"name , card , phone","aria-label":"Recipient's username","aria-describedby":"basic-addon2",type:"search",onChange:s=>{l(s.target.value)}}),e.jsx(C,{variant:"outline-secondary",className:"border-1",id:"button-addon2",children:e.jsx(H,{})})]})})})}),e.jsxs(_,{striped:!0,bordered:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Full Name"}),e.jsx("th",{children:"sex"}),e.jsx("th",{children:"status"}),e.jsx("th",{children:"Age"}),e.jsx("th",{children:"phone"}),e.jsx("th",{children:"card no"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:x.length!==0?x.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:a+1}),e.jsx("td",{children:`${s.name}`}),e.jsx("td",{children:s.gender}),e.jsx("td",{children:s.status?"patient":"inpatient"}),e.jsx("td",{children:s.age}),e.jsx("td",{children:s.phone}),e.jsx("td",{children:s.cardNumber}),c.role==="cashier"&&e.jsx("td",{children:e.jsx(C,{variant:"success",onClick:()=>{m(!0),b(s)},className:"py-1",children:"+ Assign"})})]},a)):e.jsx("tr",{children:e.jsx("td",{children:"no patient"})})})]})]}),e.jsx("hr",{})]})};export{ue as default};
