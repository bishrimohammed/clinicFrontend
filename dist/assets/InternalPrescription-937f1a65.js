import{r as l,l as H,Q as m,m as T,j as e}from"./index-adc5c439.js";import{M as z}from"./DefaultLayout-65fbaa93.js";import{f as C}from"./formatDate-f5528b17.js";import{u as K,S as $,_ as B,C as q,f as L,R as J}from"./SelectedOptions-cf20983c.js";import{u as U}from"./useQuery-0c7d53ac.js";import{A as w}from"./axiosInstance-8e812653.js";import{u as V}from"./useMutation-46d3959e.js";import{A as W}from"./useAxiosHeaders-0302b736.js";import{C as X,b as _}from"./InputGroupContext-86e132d6.js";import{F as r}from"./Form-fd32e757.js";import{R as M}from"./Row-191556ab.js";import{C as t}from"./Col-cdbc53ce.js";import{T as Y}from"./Table-892073ec.js";import{M as Z}from"./Modal-07b4d2ea.js";import{S as ee}from"./index.esm-650f3687.js";import"./index.es-ffb0b0ea.js";import"./moment-fbc5633a.js";import"./ElementChildren-abb33785.js";import"./NoopTransition-52f737ac.js";import"./divWithClassName-747f8fd3.js";var se=l.forwardRef(function(o,n){var a=K(o);return l.createElement($,B({ref:n},a))}),te=se;function re(){return U({queryKey:["Medication list"],queryFn:async()=>w.get("/medication").then(o=>o.data),staleTime:2*60*1e3})}const ne=()=>{const o=W(),n=H();return V({mutationFn:async a=>w.post("/prescriptions",a,o),onSuccess:async(a,i)=>{m.success("successfully prescribed"),n.invalidateQueries({queryKey:["MedicalHistory",i.historyId,"InternalPrescription"],exact:!0})},onError:async a=>{var i;m.success((i=a==null?void 0:a.response)==null?void 0:i.data.message)}})},_e=({history:o})=>{const[n,a]=l.useState([]),[i,x]=l.useState(null),[h,p]=l.useState(null),[j,f]=l.useState(null),{data:u}=re(),{mutateAsync:D,isPending:y}=ne(),b=l.useMemo(()=>u==null?void 0:u.map(s=>({...s,value:s._id,label:s.drugname})),[u]),g=l.useRef(),S=l.useRef(),v=l.useRef(),N=l.useRef(),{historyId:R}=T(),I=async()=>{n.length!==0&&D({medication:n,historyId:R}).then(c=>{c.status&&a([])})},k=s=>{s.preventDefault();const c=g.current.value,d=S.current.value,O=j.value,P=h.value,A=N.current.value,E=v.current.value;if(!i||!c||!d){alert("add all field");return}if(n.some(Q=>Object.values(Q).includes(i._id))){m.error("you selected already");return}const F={medicineId:i._id,dosage:c,frequency:O,route:P,number_of_days:A,qty:d,remark:E,form:""};a([...n,F]),x(null),f(null),p(null)},G=s=>b.filter(d=>d._id===s)[0].drugname;return e.jsxs(X,{className:"minHeight100  py-2",children:[e.jsxs(r,{className:"d-flex flex-column",onSubmit:k,children:[e.jsxs(M,{className:"bluewhite-bg py-1",children:[e.jsx(t,{sm:3,children:"medicine"}),e.jsx(t,{children:"dose"}),e.jsx(t,{children:"frequency"}),e.jsx(t,{sm:2,children:"route"}),e.jsx(t,{children:"StartDate"}),e.jsx(t,{children:"Qty"}),e.jsx(t,{children:e.jsx("span",{className:"text-nowrap",children:"No of days"})}),e.jsx(t,{children:"Remark"})]}),e.jsxs("div",{className:"d-flex flex-column gap-2 w-100 ",children:[e.jsxs(M,{className:"border border-1 py-3 ",children:[e.jsx(t,{sm:3,className:"ps-1 ",children:e.jsx(r.Group,{children:e.jsx(te,{className:"w-100",onChange:x,value:i,options:b})})}),e.jsx(t,{className:"ps-0",children:e.jsx(r.Group,{children:e.jsx(r.Control,{ref:g,type:"text",placeholder:"Enter..."})})}),e.jsx(t,{className:"px-0",children:e.jsx(r.Group,{className:"d-flex gap-2 align-items-center",children:e.jsx(q,{className:"w-100",isClearable:!0,options:L,onChange:f,placeholder:"",value:j})})}),e.jsx(t,{sm:2,children:e.jsx(r.Group,{className:"d-flex gap-2 align-items-center",children:e.jsx(q,{className:"w-100",isClearable:!0,options:J,onChange:p,value:h})})}),e.jsx(t,{children:e.jsx(r.Group,{children:e.jsx("div",{className:"px-3 py-2",style:{backgroundColor:"rgb(233, 236, 239)"},disabled:!0,children:C(Date.now())})})}),e.jsx(t,{className:"px-0",children:e.jsx(r.Group,{children:e.jsx(r.Control,{ref:S,type:"number"})})}),e.jsx(t,{children:e.jsx(r.Group,{children:e.jsx(r.Control,{ref:N,type:"number"})})}),e.jsx(t,{children:e.jsx(r.Group,{children:e.jsx(r.Control,{ref:v,type:"text",placeholder:"Enter..."})})})]}),e.jsx("div",{className:"d-flex ms-2",children:e.jsx(_,{disabled:!o.status,variant:"success",className:"px-4",type:"submit",children:"Add"})})]})]}),e.jsx("hr",{}),e.jsxs(Y,{striped:!0,bordered:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Drug name"}),e.jsx("th",{children:"Dosage"}),e.jsx("th",{children:"frequency"}),e.jsx("th",{children:"route"}),e.jsx("th",{children:"start Date"}),e.jsx("th",{children:"No of Days"}),e.jsx("th",{children:"quantity"}),e.jsx("th",{children:"remark"}),e.jsx("th",{children:"remove"})]})}),e.jsx("tbody",{children:n.length!==0&&n.map((s,c)=>e.jsxs("tr",{children:[e.jsx("td",{children:c+1}),e.jsx("td",{children:G(s.medicineId)}),e.jsx("td",{children:s.dosage}),e.jsx("td",{children:s.frequency}),e.jsx("td",{children:s.route}),e.jsx("td",{children:C(Date.now())}),e.jsx("td",{children:s.number_of_days}),e.jsx("td",{children:s.qty}),e.jsx("td",{children:s.remark}),e.jsx("td",{children:e.jsx(z,{color:"red",onClick:()=>{a(n.filter(d=>d.medicineId!==s.medicineId))},size:20,cursor:"pointer"})})]},c))})]}),e.jsx(Z.Footer,{style:{justifyContent:"initial"},children:e.jsx("div",{className:"d-flex w-100  justify-content-end",children:e.jsxs(_,{variant:"primary",disabled:n.length===0||y,className:"w-100",onClick:I,type:"button",children:[y&&e.jsx(ee,{animation:"border",size:"sm"}),"Prescribe"]})})})]})};export{_e as default};
