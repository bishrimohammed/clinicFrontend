import{r as y,l as B,m as C,Q as N,j as e,u as H}from"./index-adc5c439.js";import{A as T}from"./axiosInstance-8e812653.js";import{u as F}from"./useMutation-46d3959e.js";import{A as P}from"./useAxiosHeaders-0302b736.js";import{M as o}from"./Modal-07b4d2ea.js";import{F as d}from"./Form-fd32e757.js";import{R as v}from"./Row-191556ab.js";import{C as g}from"./Col-cdbc53ce.js";import{b}from"./InputGroupContext-86e132d6.js";import{u as R}from"./useQuery-0c7d53ac.js";import{f as q,a as K}from"./formatDate-f5528b17.js";import{S as D}from"./index.esm-650f3687.js";import{a as n}from"./Accordion-cd1b63b6.js";import{T as f}from"./Table-892073ec.js";import"./DefaultLayout-65fbaa93.js";import"./index.es-ffb0b0ea.js";import"./NoopTransition-52f737ac.js";import"./divWithClassName-747f8fd3.js";import"./ElementChildren-abb33785.js";import"./moment-fbc5633a.js";const E=t=>{var a,p;const i=y.useRef(),h=y.useRef(),u=B(),{historyId:s}=C(),m=P(),x=F({mutationFn:async l=>T.post(`/bill/${t.bill._id}`,l,{...m}),onSuccess:()=>{N.success("Payment is added"),u.invalidateQueries({queryKey:["billdetail",s],exact:!0})},onError:l=>{var c,j;N.error((j=(c=l==null?void 0:l.response)==null?void 0:c.data)==null?void 0:j.message)}}),r=l=>{l.preventDefault();const c=i.current.value,j=h.current.value,w=t.bill.totalAmount-t.bill.TotalpaidAmount;if(c!=w){alert("You can't pay more or less than the bill left");return}const A={paidamount:c,paymentNote:j};console.log(A),x.mutateAsync(A).then(S=>{S.status===201&&t.handleClose()})};return e.jsxs(o,{show:t.show,onHide:t.handleClose,children:[e.jsx(o.Header,{closeButton:!0,children:e.jsx(o.Title,{children:"Add Payment"})}),e.jsx(o.Body,{children:e.jsx("div",{children:e.jsxs(d,{onSubmit:r,children:[e.jsx(v,{className:"pb-1",children:e.jsx(g,{children:e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"Amount"}),e.jsx("span",{className:" ms-1 text-danger text-center",children:"* "}),e.jsx(d.Control,{ref:i,required:!0,defaultValue:((a=t==null?void 0:t.bill)==null?void 0:a.totalAmount)-((p=t==null?void 0:t.bill)==null?void 0:p.TotalpaidAmount),type:"number",placeholder:"Enter..."})]})})}),e.jsx(v,{children:e.jsx(g,{children:e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"Note"}),e.jsx("span",{className:" ms-1 text-danger text-center",children:"* "}),e.jsx(d.Control,{ref:h,required:!0,type:"text",placeholder:"Enter..."})]})})}),e.jsxs(o.Footer,{className:"pb-0",children:[e.jsx(b,{variant:"secondary",onClick:t.handleClose,children:"Cancel"}),e.jsx(b,{variant:"primary",type:"submit",children:"Add"})]})]})})})]})};function I(t){return R({queryKey:["billdetail",t],queryFn:async()=>T.get(`/bill/${t}`).then(i=>i.data),staleTime:2*60*1e3})}const ae=()=>{const[t,i]=y.useState(!1),h=()=>i(!1),{historyId:u}=C(),s=I(u),m=H(r=>r.auth.user),x=()=>{i(!0)};return s.isPending?e.jsx(D,{animation:"grow"}):s.error?"An error has occurred: "+s.error.message:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"",children:e.jsx("h4",{children:"Bill Detail information"})}),e.jsx("hr",{}),m.role==="cashier"&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{defaultActiveKey:"0",flush:!0,children:[e.jsxs(n.Item,{eventKey:"0",children:[e.jsx(n.Header,{bsPrefix:"bg-success",children:"prescription"}),e.jsx(n.Body,{children:e.jsx("div",{className:"d-flex w-100  justify-content-end",children:e.jsxs("div",{children:["Sub Total : ",s.data.prescriptionCost]})})})]}),e.jsxs(n.Item,{eventKey:"1",children:[e.jsx(n.Header,{children:" Laboratory Test"}),e.jsxs(n.Body,{children:[e.jsxs(f,{striped:!0,bordered:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:" Test Name"}),e.jsx("th",{children:"price"}),e.jsx("th",{children:"Action"})]})}),e.jsxs("tbody",{children:[s.data.labitems.map((r,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:a+1}),e.jsx("td",{children:r.test_name}),e.jsx("td",{children:r.price}),e.jsx("td",{children:"act"})]},a)),e.jsx("tr",{})]})]}),e.jsx("div",{className:"d-flex w-100  justify-content-end",children:e.jsxs("div",{children:["Sub Total : ",s.data.labCost]})})]})]}),e.jsxs(n.Item,{eventKey:"2",children:[e.jsx(n.Header,{children:" Imaging Studies Test"}),e.jsxs(n.Body,{children:[e.jsxs(f,{striped:!0,bordered:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:" Test Name"}),e.jsx("th",{children:"price"}),e.jsx("th",{children:"Action"})]})}),e.jsxs("tbody",{children:[s.data.imagingitems.map((r,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:a+1}),e.jsx("td",{children:r.test_name}),e.jsx("td",{children:r.price}),e.jsx("td",{children:"act"})]},a)),e.jsx("tr",{})]})]}),e.jsx("div",{className:"d-flex w-100  justify-content-end",children:e.jsxs("div",{children:["Total : ",s.data.imageCost]})})]})]})]}),e.jsx("hr",{}),e.jsx("div",{className:"d-flex w-100 mt-1  justify-content-end",children:e.jsx("div",{children:e.jsxs("div",{className:"d-flex mb-1 gap-5 py-2",children:[e.jsxs("div",{className:"  ",children:[e.jsx("span",{className:"fw-bold",children:"Total Amount : "}),s.data.totalAmount," birr"]})," ",e.jsxs("div",{className:"  ",children:[e.jsx("span",{className:"fw-bold",children:" paid Amount : "}),s.data.TotalpaidAmount]}),e.jsxs("div",{children:[e.jsx("span",{className:"fw-bold",children:" Amount Left : "}),e.jsxs("span",{className:`${s.data.totalAmount-s.data.TotalpaidAmount===0?"text-success":"text-danger"}`,children:[s.data.totalAmount-s.data.TotalpaidAmount," ","birr left"]})]})]})})})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{backgroundColor:" #cfe2ff"},className:"d-flex justify-content-between align-items-center mt-2 mb-2 py-1 px-3",children:[e.jsx("h3",{children:"payments"}),m.role==="cashier"&&e.jsx(b,{onClick:x,variant:"success",type:"button",children:"+ Add Payment"})]}),e.jsxs(f,{children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f2f2f2"},children:[e.jsx("th",{className:"py-2 px-1",children:"paid time"}),e.jsx("th",{className:" ",children:"Amount"}),e.jsx("th",{className:"",children:"Note"}),e.jsx("th",{className:"",children:"action"})]})}),e.jsx("tbody",{children:s.data.payments.map((r,a)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[q(r.createdAt)," ",K(r.createdAt)]}),e.jsx("td",{children:r.paidamount}),e.jsx("td",{children:r.paymentNote}),e.jsx("td",{children:"edit"})]},a))})]})]}),e.jsx(E,{show:t,handleClose:h,handleShow:x,bill:s.data})]})};export{ae as default};
